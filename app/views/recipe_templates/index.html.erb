<article>
  <header>
    <% if params["favorites"] == "1" %>
      Favorite recipes
    <% else %>
      All recipes
    <% end %>
  </header>

  <% if @recipes.any? %>
    <ul>
      <% @recipes.each do |a_recipe| %>
        <li>
          <a href="/recipes/<%= a_recipe.id %>">
            <strong><%= a_recipe.title %></strong>
          </a>

          <% if a_recipe.difficulty.present? %>
            – <em><%= a_recipe.difficulty %></em>
          <% end %>

          <% if a_recipe.rating.present? %>
            – Rating: <%= a_recipe.rating %>/5
          <% end %>

          <% if a_recipe.tags.any? %>
            – Tags:
            <%= a_recipe.tags.map(&:name).join(", ") %>
          <% end %>

          <% if a_recipe.favorite %>
            – ★ Favorite
          <% end %>

          <!-- Favorite toggle form -->
          |
          <form action="/update_recipe_favorite/<%= a_recipe.id %>"
                method="post"
                style="display:inline">

            <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
            <!-- default when unchecked -->
            <input type="hidden" name="favorite" value="0">

            <% if params["favorites"] == "1" %>
              <!-- remember user was on the favorites tab -->
              <input type="hidden" name="from_favorites" value="1">
            <% end %>

            <label>
              <input
                type="checkbox"
                name="favorite"
                value="1"
                <%= "checked" if a_recipe.favorite %>
              >
              Favorite
            </label>

            <button
              type="submit"
              formnovalidate
              style="
                padding: 2px 6px;
                font-size: 12px;
                border-radius: 4px;
                background-color: #444;
                color: white;
                border: none;
                cursor: pointer;
              "
            >
              Save
            </button>
          </form>

          <!-- Delete link -->
          |
          <a href="/delete_recipe/<%= a_recipe.id %>"
             onclick="return confirm('Delete this recipe?');">
            Delete
          </a>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p>You don't have any recipes yet.</p>
  <% end %>
</article>

<article>
  <header>
    Add a new recipe
  </header>

  <% if defined?(@recipe) && @recipe.errors.any? %>
    <div class="text-danger">
      <p>Please fix the errors below:</p>
      <ul>
        <% @recipe.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Separate form for creating a recipe -->
  <form action="/insert_recipe" method="post">
    <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">

    <div>
      <label for="recipe_title">
        Title
      </label>
      <input
        type="text"
        id="recipe_title"
        name="recipe[title]"
        value="<%= @recipe&.title %>"
        required
      >
    </div>

    <div>
      <label for="recipe_description">
        Description
      </label>
      <textarea
        id="recipe_description"
        name="recipe[description]"
        rows="3"
      ><%= @recipe&.description %></textarea>
    </div>

    <div>
      <label for="recipe_cook_time_minutes">
        Cook time (minutes)
      </label>
      <input
        type="number"
        id="recipe_cook_time_minutes"
        name="recipe[cook_time_minutes]"
        value="<%= @recipe&.cook_time_minutes %>"
      >
    </div>

    <div>
      <label for="recipe_difficulty">
        Difficulty
      </label>
      <select id="recipe_difficulty" name="recipe[difficulty]">
        <option value="">Select difficulty</option>
        <option value="Easy"   <%= "selected" if @recipe&.difficulty == "Easy" %>>Easy</option>
        <option value="Medium" <%= "selected" if @recipe&.difficulty == "Medium" %>>Medium</option>
        <option value="Hard"   <%= "selected" if @recipe&.difficulty == "Hard" %>>Hard</option>
      </select>
    </div>

    <div>
      <label for="recipe_rating">
        Rating (1–5)
      </label>
      <input
        type="number"
        id="recipe_rating"
        name="recipe[rating]"
        min="1"
        max="5"
        value="<%= @recipe&.rating %>"
      >
    </div>

    <div>
      <label>
        <input
          type="checkbox"
          id="recipe_favorite"
          name="recipe[favorite]"
          value="1"
          <%= "checked" if @recipe&.favorite %>
        >
        Mark as favorite
      </label>
    </div>

    <% if Tag.any? %>
      <fieldset>
        <legend>Tags</legend>

        <% Tag.order(:name).each do |tag| %>
          <label>
            <input
              type="checkbox"
              name="recipe[tag_ids][]"
              value="<%= tag.id %>"
              <%= "checked" if @recipe&.tag_ids&.include?(tag.id) %>
            >
            <%= tag.name %>
          </label>
        <% end %>

        <!-- ensures Rails gets an empty array when none are checked -->
        <input type="hidden" name="recipe[tag_ids][]" value="">
      </fieldset>
    <% end %>

    <button type="submit">
      Create recipe
    </button>
  </form>
</article>
